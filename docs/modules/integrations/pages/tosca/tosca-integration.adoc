= User Guide: Mobile Test Automation with Tosca

This guide explains how to create and execute a mobile test in Tosca, from project setup to test execution on a device.

== Prerequisites

* A Kobiton account with access to Public or Local/Private Devices. Obtain the following information from your Kobiton account:
** Username.
** API key.
* https://documentation.tricentis.com/tosca/2420/en/content/installation_tosca/installation.htm[Tosca Commander,window=read-later] installed and activated.

== Create or open a Tosca workspace

Follow Tosca's guidelines to https://documentation.tricentis.com/tosca/1600/en/content/tosca_commander/create_workspace_singleuser.htm#Createtheworkspace[create,window=read-later] or https://documentation.tricentis.com/tosca/1600/en/content/first_steps/get_to_know_tosca_workspace.htm?Highlight=workspace#Openaworkspace[open,window=read-later] a workspace in Tosca Commander.

== Connect to a Kobiton mobile device and scan mobile objects

In your workspace, go to the *Modules* tab.

Select *Scan -> Mobile* from the *Modules* menu.

In the *Mobile Scan* window, under *Select connection*, click *Add connection*.

* Enter a name for your connection, such as `Kobiton Cloud` or `Kobiton Standalone`.

* Set *Type* to *Appium (Generic)*.

* For *Server address*:

** For Cloud/Hybrid environments, enter `\https://api.kobiton.com/wd/hub`.
** For Cloud/Hybrid environments with custom domain, enter `\https://api-<custom-domain>.kobiton.com/wd/hub`.
** For Standalone/On-Prem environments, enter `[http|https]://[dell_ip_or_hostname]/wd/hub`.

* Select *Add*.

Under *Select device*, click *Add device*.

* Enter a device name, such as `Galaxy Tab A7 Lite` or `iPhone 14`.

* Enter the device's *UDID*.

* Select *Android* or *iOS*, and choose *Real* or *Simulated* as needed.

* Select *Add*.

Under *Select application*, click *Add app*.

* Enter a name for the app.

* For app path, use either:

** A direct download URL to the app, or

** The app's `appPackage/appActivity` (e.g., `io.appium.android.apis/io.appium.android.apis.ApiDemos`) for Android app, or `bundleId` for iOS app.

[NOTE]
If you are using `appPackage/appActivity` or `bundleId`, you must also provide the *Kobiton store app ID* (`appium:app`) under *Set capabilities*.

* Choose *Add*.

* Select *Set capabilities* to add required Appium capabilities. Include the following at minimum:

+
[cols="1,1,1"]
|===
|Capability | Value | Required?

|appium:username | <your_kobiton_username> | Yes
|appium:accessKey | <your_kobiton_access_key> | Yes
|appium:app | kobiton-store:<app_id> | No

Used for apps from the Kobiton App Repo.
|kobiton:runtime | appium | No

Used for Appium Basic 2.

|===

* Choose *Select Capability Set*.

(Optional) To scan using *Live View*, ensure *Run Live View* is checked. If using *Live View*, you must set `kobiton:runtime` to `appium` in *Set capabilities*. Otherwise, open a manual session with the device on the Kobiton Portal to navigate the app.

Select the connection, device, app, capability set then choose *Connect*.

Once the scan starts, use your mouse to interact with the app's interface and navigate as needed.

Choose *Scan* to capture the mobile screen’s UI elements. Follow Tosca's https://documentation.tricentis.com/tosca/1600/en/content/engines_3.0/mobile/mobile_scan_select_controls.htm[official guidelines,window=read-later] for more details about mobile scan.

When scanning is complete, select *Finish*.

[IMPORTANT]
====
After closing the *Mobile Scan* window, your session on Kobiton is still active until timed out. Go to the Kobiton Portal to manually terminate the session to make the device available for others or reduce public minutes use.
====

Scanned elements are stored under the *Modules* folder and can be used across test cases.

== Create a new test case with scanned objects

In your workspace, go to the *TestCases* tab.

Right-click the folder where you want to store the test case.

Select *Create TestCase* and give it a meaningful name (e.g., `Test APIDemos`).

=== Configure Appium server

Select the test case node.

In the *Properties* pane, switch to the *Test Configuration* tab.

Add the configuration key: `AppiumServer` and set its value to: `https://api.kobiton.com/wd/hub`.

=== Import standard modules

Select *Import Subset* from the *Home* menu.

Navigate to `C:\Tosca_Projects\ToscaCommander` and select the `standard.tsu` subset.

After importing, select *Modules* tab and expand the newly added `Modules_import...` folder: `Standard modules > TBox Automation Tools > Engines > Mobile`. All standard modules to be added in the next section are located here.

=== Add mobile automation modules

Drag and drop the following modules to your test case in this order:

* *Set Desired Capabilities* (located under `Mobile > Capabilities`).

+

This should be the first step in your test case. Enter the following capabilities at the minimum:

+
----
username           <kobiton_username>
accessKey          <kobiton_access_key>
udid               <device_udid>
app                kobiton-store:<app_id>
kobiton:runtime    appium
----

* *Open Mobile App*.

+

For Android apps, fill in the following:

+

----
AppPackage   io.appium.android.apis
AppActivity  io.appium.android.apis.ApiDemos
----

* Add your scanned test modules for the next steps.

* *End Appium Session* (place this module as the last step)

=== Final Test Case Structure (Example)

----
Test APIDemos
├── Set Desired Capabilities
├── Open Mobile App
├── Mobile App - Test step 1
├── Mobile App - Test step 2
└── End Appium Session
----

[IMPORTANT]
====
This structure ensures the session is properly initialized with Kobiton and cleanly terminated afterward. Without the End Appium Session step, your session might stay active on the Kobiton Portal.
====


[NOTE]
====
Name test steps clearly (e.g., "Tap Login Button", "Enter Username") for easy identification.
====

== Execute the test case on a device

Select the created test case.

Right-click and choose *Run in ScratchBook* or use *Run > ScratchBook* on the toolbar.

Start execution.

During execution, you can launch a mixed session on the device to monitor the test case.

You can add the test case to https://documentation.tricentis.com/tosca/1600/en/content/tosca_commander/execution_overview.htm[test execution,window=read-later] if needed.